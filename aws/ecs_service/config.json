{
  "kind": "AWS::ECS::Service",
  "port": {
    "entity": {
      "mappings": [
        {
          "identifier": ".ServiceName",
          "title": ".ServiceName",
          "blueprint": "service",
          "properties": {
            "service": ".ServiceName",
            "cluster": ".Cluster | split(\"/\")[1]",
            "desiredCount": ".DesiredCount",
            "taskDef": ".TaskDefinition | split(\"/\")[-1] | split(\":\")[0]",
            "arn": ".ServiceArn",
            "binaryVersion": ".Tags // [] | if isempty(.[] | select(.Key == \"autofi:binary-version\")) then \"unknown\" else .[] | select(.Key == \"autofi:binary-version\") | .Value end",
            "cpu": ".Tags // [] | if isempty(.[] | select(.Key == \"autofi:task-cpu\")) then null else .[] | select(.Key == \"autofi:task-cpu\") | .Value end",
            "memory": ".Tags // [] | if isempty(.[] | select(.Key == \"autofi:task-memory\")) then null else .[] | select(.Key == \"autofi:task-memory\") | .Value end",
            "elastic_dns": ".Tags // [] | if (isempty(.[] | select(.Key == \"autofi:env\")) or (.[] | select(.Key == \"autofi:env\") | .Value != \"prod\")) then \"a80f9247fafe4086837deb215b45c905\" else \"fe7e74b1a00f4262a7ec8532963d5ce1\" end",
            "legacy_app_name": ".Tags // [] | if isempty(.[] | select(.Key == \"autofi:app-legacy-name\")) then \"unknown\" else .[] | select(.Key == \"autofi:app-legacy-name\") | .Value end"
          },
          "relations": {
            "region": ".ServiceArn | split(\":\")[3]",
            "cloudAccount": ".ServiceArn | split(\":\")[4]",
            "stack": ".Tags // [] | if isempty(.[] | select(.Key == \"autofi:stack\")) then \"unknown\" else .[] | select(.Key == \"autofi:stack\") | .Value end",
            "env": ".Tags // [] | if isempty(.[] | select(.Key == \"autofi:env\")) then \"unknown\" else .[] | select(.Key == \"autofi:env\") | .Value end",
            "app": ".Tags // [] | if isempty(.[] | select(.Key == \"autofi:app\")) then \"unknown\" else .[] | select(.Key == \"autofi:app\") | .Value end",
            "elastic_dns_key": ".Tags // [] | (.[] | select(.Key == \"autofi:stack\") | .Value + \"_\") + (.[] | select(.Key == \"autofi:env\") | .Value)"
          }
        }
      ]
    }
  }
}
